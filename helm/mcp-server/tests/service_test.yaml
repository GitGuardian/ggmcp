suite: test service
templates:
  - service.yaml
tests:
  - it: should render service with default values
    asserts:
      - isKind:
          of: Service
      - equal:
          path: metadata.name
          value: RELEASE-NAME-gitguardian-secops-mcp-server
      - equal:
          path: spec.type
          value: ClusterIP
      - equal:
          path: spec.ports[0].port
          value: 8000
      - equal:
          path: spec.ports[0].targetPort
          value: 8000

  - it: should set custom port
    set:
      service.port: 9000
      service.targetPort: 9000
    asserts:
      - equal:
          path: spec.ports[0].port
          value: 9000
      - equal:
          path: spec.ports[0].targetPort
          value: 9000

  - it: should support service annotations
    set:
      service.annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "8000"
    asserts:
      - equal:
          path: metadata.annotations.prometheus\.io/scrape
          value: "true"
      - equal:
          path: metadata.annotations.prometheus\.io/port
          value: "8000"

  - it: should set service type to LoadBalancer
    set:
      service.type: LoadBalancer
    asserts:
      - equal:
          path: spec.type
          value: LoadBalancer
